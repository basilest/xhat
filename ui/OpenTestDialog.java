/*
 * Created on Feb 3, 2012
 *
 * 
 * @author  Basile Stefano
 */
package ui;

import javax.swing.JTable;
import javax.swing.JScrollPane;
import java.awt.*;
import java.awt.event.*;
import common.Environ;
import common.MyTableModel;

import javax.swing.*;

/**
 * @author   Basile Stefano
 */
//#####################################
public class OpenTestDialog implements ActionListener {
    
    static final String[] TestColNames = {"Test Id",
                                          "Test Name", 
                                          "Feature", 
                                          "Author",
                                          "Date"};
    
    static final String  OpenSqlCmd = "SELECT tkey, testName, Fsh, author, date from TESTS";
    
    final static String  STR_OPEN   = "Open";
    final static String  STR_CANCEL = "Cancel";

    JDialog           dialog;
    JPanel            jcontentPane;
    JPanel            jButtonPane;
    JButton           jButtonOpen;
    JButton           jButtonCancel;

    MyTableModel      tModel;
    JTable            table;
    
    int               testKey;
    String            testUserName;
    String            testFeature;

    boolean           Valid;
    


    //#####################################
        public OpenTestDialog (Environ environ)  {
            
            dialog = new JDialog(environ.getMainFrame(), true);
            Valid = false;
            
            jcontentPane = new JPanel(new BorderLayout());
 
            tModel = new MyTableModel (TestColNames);
            table  = new JTable(tModel);
            table.setSelectionMode(ListSelectionModel.SINGLE_SELECTION);
            environ.getDataBase().DBquery2JTable(tModel, OpenSqlCmd);
            (table.getTableHeader()).setReorderingAllowed (false);
            JScrollPane scrollPane = new JScrollPane(table);
            scrollPane.setPreferredSize(new Dimension(500, 100));

            dialog       = new JDialog(environ.getMainFrame(), true);
            jcontentPane = new JPanel(new BorderLayout());
            jButtonPane  = new JPanel(new FlowLayout());

            jButtonOpen   = new JButton (STR_OPEN);
            jButtonOpen.setActionCommand(STR_OPEN);
            jButtonOpen.addActionListener(this);

            jButtonCancel = new JButton   (STR_CANCEL);
            jButtonCancel.setActionCommand(STR_CANCEL);
            jButtonCancel.addActionListener(this);

            jButtonPane.add(jButtonOpen);
            jButtonPane.add(jButtonCancel);

            jcontentPane.add (scrollPane,  BorderLayout.CENTER);
            jcontentPane.add (jButtonPane, BorderLayout.SOUTH);
            

            dialog.setContentPane(jcontentPane);
            dialog.setDefaultCloseOperation(JDialog.DISPOSE_ON_CLOSE);
           (dialog.getRootPane()).setDefaultButton(jButtonOpen);
            dialog.setLocationRelativeTo(environ.getMainFrame());
            dialog.pack();
            dialog.setVisible(true);
        }

    //#####################################
    public int getTestKey() {
           return testKey;
    }
    //#####################################
    public String getTestUserName() {
           return testUserName;
    }
    //#####################################
    public String getTestFeature() {
           return testFeature;
    }
    //#####################################
    public boolean isValid() {
           return Valid;
    }
    //#####################################
      public void actionPerformed(ActionEvent e) {

         String command = e.getActionCommand();
         do {
            if (STR_OPEN.equals(command)) {
                int row = table.getSelectedRow();
                if (row != -1) { 
                    testKey      = Integer.parseInt(tModel.getValueAt(row, 0).toString());
                    testUserName = tModel.getValueAt(row, 1).toString();
                    testFeature  = tModel.getValueAt(row, 2).toString();
                    Valid = true;
                }
                dialog.dispose();
                break;
            }
            if (STR_CANCEL.equals(command)) {
                dialog.dispose();
                break;
            }         
         } while(false) ;
      }
} // end class OpenTestDialog
